services:
  # --- notification manager ---
  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=100
      - TZ=Europe/Vienna
    volumes:
      - /data/docker/prowlarr:/config
    ports:
      - 10101:9696
    restart: unless-stopped

  # --- movie manager ---
  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID=1000
      - PGID=100
      - TZ=Europe/Vienna
    volumes:
      - /data/docker/sonarr:/config
      - /data:/data
    ports:
      - 10102:8989
    restart: unless-stopped

  # --- series manager ---
  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID=1000
      - PGID=100
      - TZ=Europe/Vienna
    volumes:
      - /data/docker/radarr:/config
      - /data:/data
    ports:
      - 10103:7878
    restart: unless-stopped

  # --- subtitle manager ---
  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    environment:
      - PUID=1000
      - PGID=100
      - TZ=Europe/Vienna
    volumes:
      - /data/docker/bazarr:/config
      - /data:/data
    ports:
      - 10104:6767
    restart: unless-stopped

  # --- overseer ---
  overseerr:
    image: sctx/overseerr:latest
    container_name: overseerr
    environment:
      - PUID=1000
      - PGID=100
      - TZ=Europe/Vienna
    volumes:
      - /data/docker/overseerr:/app/config
    ports:
      - 10105:5055
    restart: unless-stopped

  # Usenet download client
  sabnzbd:
    image: lscr.io/linuxserver/sabnzbd:latest
    container_name: sabnzbd
    environment:
      - PUID=1000
      - PGID=100
      - TZ=Europe/Vienna
    volumes:
      - /data/docker/sabnzbd:/config
      - /data:/data
    ports:
      - 10106:8080
    restart: unless-stopped

  # --- PLAYER ---
  plex:
    image: lscr.io/linuxserver/plex:latest
    container_name: plex
    # Removed network_mode: host to allow container-to-container networking
    ports:
      - 32400:32400
      - 1900:1900/udp   # DLNA discovery
      - 5353:5353/udp   # Bonjour/Avahi
      - 8324:8324       # Plex Companion
      - 32410:32410/udp # GDM network discovery
      - 32412:32412/udp # GDM network discovery
      - 32413:32413/udp # GDM network discovery
      - 32414:32414/udp # GDM network discovery
      - 32469:32469     # DLNA server
    environment:
      - PUID=1000
      - PGID=100
      - TZ=Europe/Vienna
      - VERSION=docker
    volumes:
      - /data/docker/plex:/config
      - /data/media:/data/media
    devices:
      - /dev/dri:/dev/dri # Passes the i5-12400 iGPU for transcoding
    restart: unless-stopped

  # --- GATEWAY ---
  nginx:
    image: nginx:alpine
    container_name: nginx-proxy
    ports:
      - 80:80
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    extra_hosts:
      - "host.docker.internal:host-gateway"
      - "hmsrvr:host-gateway"
    depends_on:
      - prowlarr
      - sonarr
      - radarr
      - bazarr
      - overseerr
      - sabnzbd
    restart: unless-stopped
